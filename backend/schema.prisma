generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ==================== ENTITÉS PRINCIPALES ====================

model Users {
  id_user  Int    @id @default(autoincrement())
  username String @db.VarChar(100)
  email    String @unique @db.VarChar(150)
  password String @db.VarChar(255)

  @@map("USERS")
}

model Albums {
  id_album     Int       @id @default(autoincrement())
  title        String    @db.VarChar(150)
  release_date DateTime? @db.Date
  cover_art    String?   @db.VarChar(255)

  // Relations
  tracks   Contains[]
  artists  Creates[]
  pictures Pictures[]

  @@map("ALBUMS")
}

model Artists {
  id_artist     Int       @id @default(autoincrement())
  name          String    @db.VarChar(100)
  avatar        String?   @db.VarChar(255)
  biography     String?   @db.Text
  date_of_birth DateTime? @db.Date

  // Relations
  albums   Creates[]
  tracks   Performs[]
  pictures Pictures[]

  @@map("ARTISTS")
}

model Tracks {
  id_track Int     @id @default(autoincrement())
  title    String  @db.VarChar(150)
  duration Int?    @default(0)

  // Relations
  albums   Contains[]
  artists  Performs[]
  genres   Classifies[]
  pictures Pictures[]

  @@map("TRACKS")
}

model Genres {
  id_genre    Int     @id @default(autoincrement())
  title       String  @db.VarChar(100)
  description String? @db.Text

  // Relations
  tracks Classifies[]

  @@map("GENRES")
}

model Pictures {
  id_picture Int     @id @default(autoincrement())
  filename   String  @db.VarChar(255)
  label      String? @db.VarChar(100)
  
  // Clés étrangères optionnelles
  id_track   Int?
  id_album   Int?
  id_artist  Int?

  // Relations
  track  Tracks?  @relation(fields: [id_track], references: [id_track], onDelete: Cascade)
  album  Albums?  @relation(fields: [id_album], references: [id_album], onDelete: Cascade)
  artist Artists? @relation(fields: [id_artist], references: [id_artist], onDelete: Cascade)

  @@map("PICTURES")
}

// ==================== TABLES D'ASSOCIATION ====================

model Classifies {
  id_genre Int
  id_track Int

  genre Genres @relation(fields: [id_genre], references: [id_genre], onDelete: Cascade)
  track Tracks @relation(fields: [id_track], references: [id_track], onDelete: Cascade)

  @@id([id_genre, id_track])
  @@map("CLASSIFIES")
}

model Contains {
  id_album Int
  id_track Int

  album Albums @relation(fields: [id_album], references: [id_album], onDelete: Cascade)
  track Tracks @relation(fields: [id_track], references: [id_track], onDelete: Cascade)

  @@id([id_album, id_track])
  @@map("CONTAINS")
}

model Creates {
  id_artist Int
  id_album  Int

  artist Artists @relation(fields: [id_artist], references: [id_artist], onDelete: Cascade)
  album  Albums  @relation(fields: [id_album], references: [id_album], onDelete: Cascade)

  @@id([id_artist, id_album])
  @@map("CREATES")
}

model Performs {
  id_artist      Int
  id_track       Int
  is_main_artist Boolean? @default(true) // Correspond au tinyint(1) DEFAULT 1

  artist Artists @relation(fields: [id_artist], references: [id_artist], onDelete: Cascade)
  track  Tracks  @relation(fields: [id_track], references: [id_track], onDelete: Cascade)

  @@id([id_artist, id_track])
  @@map("PERFORMS")
}
